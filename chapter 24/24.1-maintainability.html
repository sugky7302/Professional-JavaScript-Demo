<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script>
    // 通过初始化指定变量类型
    var found = false;       // 布尔型
    var count = -1;         // 数字
    var name = '';          // 字符串
    var person = null;      // 对象

    // 用于指定数据类型的匈牙利标记法
    var bFound;     // 布尔型
    var iCount;     // 整数
    var sName;      // 字符串
    var oPerson;    // 对象

    // 用于指定类型的类型注释
    var found /*:Boolean*/ = false;
    var count /*:int*/ = 10;
    var name /*:String*/ = 'tc';
    var person /*Object*/ = null;
</script>

<!--使用了<script>的紧密耦合的HTML和JavaScript-->
<script>
    document.write('hello');
</script>

<!--使用事件处理程序属性值的紧密耦合的HTML和JavaScript-->
<input type="button" value="click me" onclick="doSomething()" />

<script>
    // 将HTML紧密耦合到JavaScript
    function insertMessage(msg) {
        var container = document.getElementById('container');
        container.innerHTML = '<div class="msg"><p class="post">' + msg +'</p>' + '<p><em>latest message above.</em></p></div>';
    }

    // css对JavaScript的紧密耦合
    element.style.color = 'red';
    element.style.backgroundColor = 'blue';

    // css对JavaScript的松散耦合
    element.className = 'edit';

    function handleKeyPress(event) {
        event = EventUtil.getEvent(event);
        if (event.keyCode == 13) {
            var target = EventUtil.getTarget(event);
            var value = 5 * parseInt(target.value);
            if (value > 10) {
                document.getElementById('error-msg').style.display = 'block';
            }
        }
    }

    function validateValue(value) {
        value = 5 * parseInt(value);
        if (value > 10) {
            document.getElementById('error-msg').style.display = 'block';
        }
    }

    function handleKeyPress(event) {
        event = EventUtil.getEvent(event);
        if (event.keyCode == 13) {
            var target = EventUtil.getTarget(event);
            validateValue(target.value);
        }
    }

    // 两个全局量---避免
    var name = 'tc';
    function sayName() {
        console.log(name);
    }

    // 一个全局量---推荐
    var MyApplication = {
        name: 'tc',
        sayName: function () {
            console.log('this.name');
        }
    };

    // 创建全局对象
    var Wrox = {};

    // 为Professional JavaScript创建命名空间
    Wrox.ProJS = {};

    // 将书中用到的对象附加上去
    Wrox.ProJS.EventUtil = {};
    Wrox.ProJS.CookieUtil = {};

    function sortArray(values) {
        if (values != null) {       // 避免
            values.sort(comparator);
        }
    }

    function sortArray(values) {
        if (values instanceof Array) {       // 推荐
            values.sort(comparator);
        }
    }

    function validate(value) {
        if (!value) {
            console.log('invalid value!');
            location.href = '/errors/invalid.php';
        }
    }

    var Constants = {
        INVALID_VALUE_MSG: 'invalid value!',
        INVALID_VALUE_URL: '/errors/invalid.php'
    };

    function validate(value) {
        if (!value) {
            alert(Constants.INVALID_VALUE_MSG);
            location.href = Constants.INVALID_VALUE_URL;
        }
    }

    function updateUI() {
        var imgs = document.getElementsByTagName('img');
        for (var i = 0, len = imgs.length; i < len; i++) {
            imgs[i].title = document.title + ' image ' + i;
        }
        var msg = document.getElementById('msg');
        msg.innerHTML = 'Update complete';
    }

    function updateUI() {
        var doc = document;
        var imgs = doc.getElementsByTagName('img');
        for (var i = 0, len = imgs.length; i < len; i++) {
            imgs[i].title = doc.title + ' image ' + i;
        }
        var msg = doc.getElementById('msg');
        msg.innerHTML = 'Update complete';
    }

    function updateBody() {
        with (document.body) {
            alert(tagName);
            innerHTML = 'hello';
        }
    }

    function updateBody() {
        var body = document.body;
        alert(body.tagName);
        body.innerHTML = 'hello';
    }

    var value = 5;
    var sum = 10 + value;
    console.log(sum);

    var value = [5, 10];
    var sum = value[0] + value[1];
    console.log(sum);

    var value = { first: 5, second: 10};
    var sum = value.first + value.second;
    console.log(sum);

    var query = window.location.href.substring(window.location.href.indexOf('?'));

    var url = window.location.href;
    var query = url.substring(url.indexOf('?'));

    for (var i = 0; i < value.length; i++) {
        process(value[i]);
    }

    for (var i = value.length - 1; i >= 0; i--) {
        process(value[i]);
    }

    var i = value.length - 1;
    if (i > -1) {
        do {
            process(value[i]);
        } while (--i >= 0);
    }

    // 消除循环
    process(value[0]);
    process(value[1]);
    process(value[2]);

    // 假设 values.length > 0
    var iterations = Math.ceil(values.length / 8);
    var startAt = values.length % 8;
    var i = 0;

    do {
        switch (startAt) {
            case 0 : process(values[i++]);
            case 7 : process(values[i++]);
            case 6 : process(values[i++]);
            case 5 : process(values[i++]);
            case 4 : process(values[i++]);
            case 3 : process(values[i++]);
            case 2 : process(values[i++]);
            case 1 : process(values[i++]);
        }
        startAt = 0;
    } while (--iterations > 0);

    var iterations = Math.floor(values.length / 8);
    var leftover = values.length % 8;
    var i = 0;

    if (leftover > 0 ) {
        do {
            process(values[i++]);
        } while (--leftover > 0);
    }
    do {
        process(values[i++]);
        process(values[i++]);
        process(values[i++]);
        process(values[i++]);
        process(values[i++]);
        process(values[i++]);
        process(values[i++]);
        process(values[i++]);
        process(values[i++]);
    } while (--iterations > 0);

    // 某些代码求值--避免
    eval('alert("hello")');

    // 创建新函数--避免
    var sayHi = new Function('alert("hello")');

    // 设置超时--避免
    setTimeout('alert("hello")', 500);

    // 已修正
    alert('hello');

    // 创建新函数--已修正
    var sayHi = function () {
        alert('hello');
    };

    // 设置一个超时--已修正
    setTimeout(function () {
        alert('hello');
    }, 500);

    // 4个语句---很浪费
    var count = 5;
    var color = 'blue';
    var values = [1, 2, 3];
    var now = new Date();

    // 一个语句
    var count = 5,
        color = 'blue',
        values = [1, 2, 3],
        now = new Date();

    var name = values[i];
    i++;

    var name = values[i++];
</script>
</body>
</html>