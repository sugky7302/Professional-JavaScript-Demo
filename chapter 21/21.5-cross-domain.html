<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script>
    var img = new Image();
    img.onload = img.onerror = function () {
        console.log('done')
    };
    img.src = 'http://tc9011.com/test?name=tc';

    function handleResponse(response) {
        console.log('you are at ip address' + response.ip + ', which is in ' + response.city + ', ' + response.region_name);
    }

    var script = document.createElement('script');
    script.src = 'http://freegeoip.net/json/?callback=handleResponse';
    document.body.insertBefore(script, document.body.firstChild);

    function createStreamingClient(url, progress, finished) {
        var xhr = new XMLHttpRequest(),
            received = 0;

        xhr.open('get', url, true);
        xhr.onreadystatechange = function () { 
            var result;
            
            if (xhr.readyState == 3) {
                
                // 只取得最新数据并调整计数器
                result = xhr.responseText.substring(received);
                received += result.length;
                
                // 调用progress回调函数
                progress(result);
            } else if (xhr.readyState == 4){
                finished(xhr.responseText);
            }
        };
        xhr.send(null);
        return xhr;
    }
    
    var client = createStreamingClient('streaming.php', function (data) {
        console.log('received: ' + data);
    }, function (data) {
        console.log('Done');
    });
</script>
</body>
</html>